---
description: Qubes OS networking and qubes.ConnectTCP for cross-VM access
alwaysApply: true
---

# Qubes OS Networking

## Default model

- VMs are client-only; NetVM masquerades outbound, blocks inbound
- VMs get IPs in 10.137.x.x range, not routable from other VMs

## qubes.ConnectTCP (preferred)

Built-in qrexec service for safe TCP tunnelling between VMs. No network routing changes needed.

### How it works

1. **Dom0 policy** allows specific VMs to connect to specific ports on a target VM
2. **Client VM** runs `qvm-connect-tcp <local-port>:<target-vm>:<remote-port>`
3. Traffic goes through **Xen vchan** (not the network stack) — fully isolated

### Dom0 policy (hardened — admin-only access)

```
# /etc/qubes/policy.d/50-openclaw.policy

# Only openclaw-admin can reach the server ports
qubes.ConnectTCP +32125 openclaw-admin visyble allow
qubes.ConnectTCP +18789 openclaw-admin visyble allow

# Deny all other VMs
qubes.ConnectTCP +32125 @anyvm visyble deny
qubes.ConnectTCP +18789 @anyvm visyble deny
```

### Client usage (from openclaw-admin)

```bash
qvm-connect-tcp 32125:visyble:32125
qvm-connect-tcp 18789:visyble:18789
curl http://localhost:32125/health
xdg-open http://localhost:18789/#token=<token>
```

### Security defaults

- **openclaw-admin** firewall: DNS-only + drop-all (no internet, qrexec-only)
- **visyble** firewall: outbound-only (needed for cursor-agent)
- Both VMs tagged `ai-services` for Qubes Manager grouping
- VM features store role, ports, and description for admin visibility
